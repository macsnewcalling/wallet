<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FTC Wallet </title>

  <!-- Tailwind CDN for quick styling (demo only) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Small visual helpers */
    .img-preview { max-width: 100%; max-height: 160px; object-fit: contain; border-radius: 8px; border: 1px dashed #e6e6e6; padding: 6px; background: #fff; }
    .step-box { background: rgba(255,255,255,0.9); border-radius: 12px; padding: 18px; box-shadow: 0 6px 24px rgba(15,23,42,0.06); }
    .btn { @apply rounded-2xl px-4 py-2 font-semibold shadow-sm; }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-indigo-50 min-h-screen font-sans text-slate-900">

  <div class="max-w-6xl mx-auto p-6">
    <!-- Header -->
    <header class="flex items-center justify-between mb-8">
      <div class="flex items-center gap-4">
        <div class="h-12 w-12 rounded-2xl bg-indigo-600 shadow" aria-hidden="true"></div>
        <div>
          <h1 class="text-2xl font-extrabold">Federal Trade Commission Wallet</h1>
          <p class="text-sm text-slate-600">Secure Wallet  —  (For USA citizens only)</p>
        </div>
      </div>
      <nav class="flex items-center gap-3">
        <button id="nav-home" class="px-3 py-2 rounded-md bg-white border" aria-label="Home">Home</button>
        <button id="nav-login" class="px-3 py-2 rounded-md bg-indigo-600 text-white">Log In</button>
        <button id="nav-signup" class="px-3 py-2 rounded-md bg-emerald-600 text-white">Sign Up</button>
      </nav>
    </header>

    <!-- Main content -->
    <main id="main" class="min-h-[520px]">
      <!-- Home -->
      <section id="page-home" class="page">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="step-box"></p>
            <div class="flex gap-3">
              <button id="home-getstarted" class="btn bg-indigo-600 text-white">Get Started</button>
              <button id="home-login" class="btn bg-white border">I already have an account</button>
            </div>
          </div>
          <div class="step-box">
            <h3 class="text-lg font-semibold mb-2">What this demo contains</h3>
            <ul class="list-disc ml-5 text-slate-700 space-y-1">
              <li>Multi-step Sign Up exactly following the order you provided.</li>
              <li>Account types: <strong>Victim account (11.5%)</strong>, <strong>Suspect account(3.5%)</strong>, <strong>Perpetrator account(0%)</strong>.</li>
              <li>Prank Document upload, 30s FTC-connection simulation, account number selection from a 6-digit sequence, username/password creation, 2-minute scanning, device registration, IP entry, security type, token validation.</li>
              <li>Login uses the same signup details; Dashboard shows everything you submitted.</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Signup -->
      <section id="page-signup" class="page hidden">
        <div class="step-box max-w-3xl mx-auto">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold">Sign Up — Multi-step Onboarding</h2>
            <div class="text-sm text-slate-500">Follow steps in order — required for  completion</div>
          </div>

          <div id="signup-steps">

            <!-- Step 1: Personal Information -->
            <div id="step-1" class="signup-step">
              <h3 class="font-semibold mb-2">Personal Information</h3>
              <p class="text-sm text-slate-600 mb-3">Please enter your legal first and last name and SSN number.</p>
              <div class="grid md:grid-cols-2 gap-3">
                <div>
                  <label class="block text-sm font-medium">First name</label>
                  <input id="firstName" class="w-full mt-1 p-2 rounded-lg border" placeholder="First name" />
                </div>
                <div>
                  <label class="block text-sm font-medium">Last name</label>
                  <input id="lastName" class="w-full mt-1 p-2 rounded-lg border" placeholder="Last name" />
                </div>
              </div>
              <div class="mt-3">
                <label class="block text-sm font-medium">SSN number</label>
                <input id="tsn" class="w-full mt-1 p-2 rounded-lg border" placeholder="TSN number" />
              </div>
              <div class="flex gap-3 mt-4">
                <button id="step1-next" class="btn bg-indigo-600 text-white">Next</button>
                <button id="step1-cancel" class="btn bg-white border">Cancel</button>
              </div>
            </div>

            <!-- Step 2: Contact Information -->
            <div id="step-2" class="signup-step hidden">
              <h3 class="font-semibold mb-2">Contact Information</h3>
              <p class="text-sm text-slate-600 mb-3">Provide a primary email and contact phone. Alternate fields are optional.</p>
              <div class="grid gap-3">
                <div>
                  <label class="block text-sm font-medium">Email</label>
                  <input id="email" class="w-full mt-1 p-2 rounded-lg border" placeholder="you@example.com" />
                </div>
                <div>
                  <label class="block text-sm font-medium">Alternative email</label>
                  <input id="altEmail" class="w-full mt-1 p-2 rounded-lg border" placeholder="optional@example.com" />
                </div>
                <div class="grid md:grid-cols-2 gap-3">
                  <div>
                    <label class="block text-sm font-medium">Phone</label>
                    <input id="phone" class="w-full mt-1 p-2 rounded-lg border" placeholder="+1 555 123 4567" />
                  </div>
                  <div>
                    <label class="block text-sm font-medium">Alternative phone</label>
                    <input id="altPhone" class="w-full mt-1 p-2 rounded-lg border" placeholder="optional phone" />
                  </div>
                </div>
              </div>
              <div class="flex gap-3 mt-4">
                <button id="step2-back" class="btn bg-white border">Back</button>
                <button id="step2-next" class="btn bg-indigo-600 text-white">Next</button>
              </div>
            </div>

            <!-- Step 3: Address Confirmation -->
            <div id="step-3" class="signup-step hidden">
              <h3 class="font-semibold mb-2">Address Confirmation</h3>
              <p class="text-sm text-slate-600 mb-3">Select your U.S. state, then city, ZIP and full postal address.</p>
              <div class="grid md:grid-cols-2 gap-3">
                <div>
                  <label class="block text-sm font-medium">State (USA)</label>
                  <select id="state" class="w-full mt-1 p-2 rounded-lg border">
                    <option value="">Select state</option>
                    <option>California</option>
                    <option>Texas</option>
                    <option>Florida</option>
                    <option>New York</option>
                    <option>Illinois</option>
                    <option>Pennsylvania</option>
                    <option>Ohio</option>
                    <option>Georgia</option>
                    <option>North Carolina</option>
                    <option>Michigan</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium">City</label>
                  <select id="city" class="w-full mt-1 p-2 rounded-lg border">
                    <option value="">Select state first</option>
                  </select>
                </div>
              </div>
              <div class="grid md:grid-cols-2 gap-3 mt-3">
                <div>
                  <label class="block text-sm font-medium">ZIP code</label>
                  <input id="zip" class="w-full mt-1 p-2 rounded-lg border" placeholder="94103" />
                </div>
                <div>
                  <label class="block text-sm font-medium">Full address</label>
                  <input id="fullAddress" class="w-full mt-1 p-2 rounded-lg border" placeholder="123 Market St Apt 4B" />
                </div>
              </div>
              <div class="flex gap-3 mt-4">
                <button id="step3-back" class="btn bg-white border">Back</button>
                <button id="step3-next" class="btn bg-indigo-600 text-white">Next</button>
              </div>
            </div>

            <!-- Step 4: Choose Account Type -->
            <div id="step-4" class="signup-step hidden">
              <h3 class="font-semibold mb-2">Choose Account Type</h3>
              <p class="text-sm text-slate-600 mb-3">Select one account type. Interest rates are fixed values.</p>

              <div class="grid md:grid-cols-3 gap-3">
                <label class="p-4 rounded-xl border cursor-pointer" id="plan-victim">
                  <div class="flex justify-between items-center">
                    <div class="font-semibold">Victim account</div>
                    <div class="text-sm text-slate-600">11.5%</div>
                  </div>
                  <div class="text-xs text-slate-600 mt-2">Account for hacking issues.</div>
                  <input type="radio" name="accountType" value="Victim" class="mt-3" />
                </label>

                <label class="p-4 rounded-xl border cursor-pointer" id="plan-suspect">
                  <div class="flex justify-between items-center">
                    <div class="font-semibold">Suspect</div>
                    <div class="text-sm text-slate-600">3.5%</div>
                  </div>
                  <div class="text-xs text-slate-600 mt-2">Saver-style account .</div>
                  <input type="radio" name="accountType" value="Suspect" class="mt-3" />
                </label>

                <label class="p-4 rounded-xl border cursor-pointer" id="plan-perp">
                  <div class="flex justify-between items-center">
                    <div class="font-semibold">Perpetrator</div>
                    <div class="text-sm text-slate-600">0%</div>
                  </div>
                  <div class="text-xs text-slate-600 mt-2">Basic account .</div>
                  <input type="radio" name="accountType" value="Perpetrator" class="mt-3" />
                </label>
              </div>

              <div class="flex gap-3 mt-4">
                <button id="step4-back" class="btn bg-white border">Back</button>
                <button id="step4-next" class="btn bg-indigo-600 text-white">Next</button>
              </div>
            </div>

            <!-- Step 5: ID Verification ( Passport / Prank SSN / Prank Driver's License) -->
            <div id="step-5" class="signup-step hidden">
              <h3 class="font-semibold mb-2">ID Verification </h3>
              <p class="text-sm text-slate-600 mb-3"> Select a  document type and upload front and back images.</p>

              <div class="grid gap-3">
                <label class="block text-sm font-medium">Choose a  document type</label>
                <select id="prankDocType" class="w-full mt-1 p-2 rounded-lg border">
                  <option> Passport</option>
                  <option> SSN</option>
                  <option> Driver's License</option>
                </select>

                <div class="grid md:grid-cols-2 gap-3">
                  <div>
                    <label class="block text-sm font-medium">Upload front (image)</label>
                    <input id="prankFront" type="file" accept="image/*" class="mt-2" />
                    <div id="previewFront" class="mt-2"></div>
                  </div>
                  <div>
                    <label class="block text-sm font-medium">Upload back (image)</label>
                    <input id="prankBack" type="file" accept="image/*" class="mt-2" />
                    <div id="previewBack" class="mt-2"></div>
                  </div>
                </div>

                <div class="mt-2">
                  <button id="start-ftc-conn" class="btn bg-indigo-600 text-white">Start connection (30s)</button>
                  <div id="ftc-status" class="text-sm text-slate-500 mt-2">Status: not connected</div>
                </div>

                <div class="mt-1">
                  <button id="step5-back" class="btn bg-white border">Back</button>
                  <button id="step5-next" class="btn bg-indigo-600 text-white">Next</button>
                </div>
              </div>
            </div>

            <!-- Step 6: Choose Account Number (6-digit sequence ) -->
            <div id="step-6" class="signup-step hidden">
              <h3 class="font-semibold mb-2">Choose an Account Number</h3>
              <p class="text-sm text-slate-600 mb-3">Enter a 6-digit sequence; we will generate a few 12-digit account number options containing that sequence.</p>

              <div class="flex gap-3">
                <input id="seq6" class="w-48 p-2 border rounded-lg" placeholder="6-digit sequence" maxlength="6" />
                <button id="gen-acc-opts" class="btn bg-indigo-600 text-white">Generate Options</button>
              </div>

              <div id="acc-options" class="grid md:grid-cols-2 gap-2 mt-3"></div>

              <div class="flex gap-3 mt-4">
                <button id="step6-back" class="btn bg-white border">Back</button>
                <button id="step6-next" class="btn bg-indigo-600 text-white">Next</button>
              </div>
            </div>

            <!-- Step 7: Username & Password -->
            <div id="step-7" class="signup-step hidden">
              <h3 class="font-semibold mb-2">Choose Credentials</h3>
              <p class="text-sm text-slate-600 mb-3">Choose a secure username and password.</p>

              <div class="grid md:grid-cols-2 gap-3">
                <div>
                  <label class="block text-sm font-medium">Username</label>
                  <input id="username" class="w-full mt-1 p-2 rounded-lg border" />
                </div>
                <div>
                  <label class="block text-sm font-medium">Password</label>
                  <input id="password" type="password" class="w-full mt-1 p-2 rounded-lg border" />
                </div>
              </div>

              <div class="mt-3">
                <label class="block text-sm font-medium">Confirm Password</label>
                <input id="passwordConfirm" type="password" class="w-full mt-1 p-2 rounded-lg border" />
              </div>

              <div class="flex gap-3 mt-4">
                <button id="step7-back" class="btn bg-white border">Back</button>
                <button id="step7-submit" class="btn bg-indigo-600 text-white">Submit (start 2-minute scan)</button>
              </div>
            </div>

            <!-- Start scanning (after Submit) -->
            <div id="step-scan-2min" class="signup-step hidden">
              <h3 class="font-semibold mb-2">Scanning Documents</h3>
              <p class="text-sm text-slate-600 mb-3">We're scanning the documents you have submitted. Please wait.</p>
              <div class="p-4 bg-yellow-50 rounded-lg border text-slate-700">
                <div id="scan2-countdown" class="font-mono text-lg">02:00</div>
                <div class="text-sm text-slate-500 mt-2">Status: scanning</div>
              </div>
            </div>

            <!-- Step 8: Register Devices -->
            <div id="step-8" class="signup-step hidden">
              <h3 class="font-semibold mb-2">Register Device(s)</h3>
              <p class="text-sm text-slate-600 mb-3">Select how many devices you want for this account and which devices .</p>

              <div class="grid md:grid-cols-2 gap-3">

                <div>
                  <label class="block text-sm font-medium">How many devices (1–5)</label>
                  <select id="deviceCount" class="w-full mt-1 p-2 rounded-lg border">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                  </select>
                </div>

                <div>
                  <label class="block text-sm font-medium">Select device types (multi-select)</label>
                  <select id="deviceTypes" multiple class="w-full mt-1 p-2 rounded-lg border" size="4">
                    <option>Computer</option>
                    <option>Laptop</option>
                    <option>Desktop</option>
                    <option>Cell Phone</option>
                    <option>Tablet</option>
                    <option>Other</option>
                  </select>
                </div>
              </div>

              <div class="flex gap-3 mt-4">
                <button id="step8-back" class="btn bg-white border">Back</button>
                <button id="step8-next" class="btn bg-indigo-600 text-white">Next</button>
              </div>
            </div>

            <!-- Step 9: Register your device IP -->
            <div id="step-9" class="signup-step hidden">
              <h3 class="font-semibold mb-2">Register Your Device IP Address</h3>
              <p class="text-sm text-slate-600 mb-3">Enter the IP address you want to register for this account .</p>

              <div>
                <label class="block text-sm font-medium">Device IP address</label>
                <input id="deviceIp" class="w-full mt-1 p-2 rounded-lg border" placeholder="e.g., 203.0.113.5 (demo)" />
              </div>

              <div class="flex gap-3 mt-4">
                <button id="step9-back" class="btn bg-white border">Back</button>
                <button id="step9-next" class="btn bg-indigo-600 text-white">Next</button>
              </div>
            </div>

            <!-- Step 10: Select Security Type & Token -->
            <div id="step-10" class="signup-step hidden">
              <h3 class="font-semibold mb-2">Select Your Security Type & Provide Token</h3>
              <p class="text-sm text-slate-600 mb-3">Choose a security tier and enter the token ID. <strong>Note: only the registered FTC officer can generate the token ID for account openings (demo).</strong></p>

              <div class="grid md:grid-cols-2 gap-3">
                <div>
                  <label class="block text-sm font-medium">Security type</label>
                  <select id="securityType" class="w-full mt-1 p-2 rounded-lg border">
                    <option value="regular">regular securities with 2 layers </option>
                    <option value="pro">pro securities with 4 layers</option>
                    <option value="pro+">pro+ securities with 9 layrs (paid version/token id)</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium">Enter the Token ID</label>
                  <input id="tokenId" class="w-full mt-1 p-2 rounded-lg border" placeholder="Enter token ID" />
                </div>
              </div>

              <div class="mt-3">
                <button id="validate-token" class="btn bg-indigo-600 text-white">Validate Token</button>
                <div id="token-result" class="mt-2 text-sm"></div>
              </div>

              <div class="flex gap-3 mt-4">
                <button id="step10-back" class="btn bg-white border">Back</button>
                <button id="step10-next" class="btn bg-indigo-600 text-white">Start Final Scan</button>
              </div>
            </div>

            <!-- Final 3-minute scanning -->
            <div id="step-final-scan" class="signup-step hidden">
              <h3 class="font-semibold mb-2">Final Scanning</h3>
              <p class="text-sm text-slate-600 mb-3">We are scanning the details.  Please wait.</p>
              <div class="p-4 bg-yellow-50 rounded-lg border">
                <div id="scan3-countdown" class="font-mono text-lg">03:00</div>
                <div class="text-sm text-slate-500 mt-2">We're scanning the details.</div>
              </div>
              <div class="mt-4 text-sm text-slate-600">When the final scan completes, your account will be queued for manual verification (1–4 hours). </div>
            </div>

            <!-- Final message (after scan): "your account would be active after manual verification" -->
            <div id="step-complete" class="signup-step hidden">
              <h3 class="font-semibold mb-2">Submission Complete</h3>
              <p class="text-sm text-slate-700 mb-3">Your account would be active after a manual verification. It might take <strong>1–4 hours</strong>. Thank you.</p>
              <p class="text-sm text-slate-500"> <span id="redirect-countdown">60</span> seconds.</p>
            </div>

            <!-- Summary (optional but visible on completion and dashboard) -->
          </div>
        </div>
      </section>

      <!-- Login page -->
      <section id="page-login" class="page hidden">
        <div class="step-box max-w-md mx-auto">
          <h2 class="text-xl font-bold mb-3">Log In</h2>
          <p class="text-sm text-slate-600 mb-3">Log in with your email or username and password created during sign up.</p>

          <div>
            <label class="block text-sm font-medium">Email or Username</label>
            <input id="loginId" class="w-full mt-1 p-2 rounded-lg border" />
          </div>
          <div class="mt-2">
            <label class="block text-sm font-medium">Password</label>
            <input id="loginPassword" type="password" class="w-full mt-1 p-2 rounded-lg border" />
          </div>

          <div class="flex gap-3 mt-4">
            <button id="login-cancel" class="btn bg-white border">Cancel</button>
            <button id="login-submit" class="btn bg-indigo-600 text-white">Log In</button>
          </div>

          <div id="login-error" class="text-rose-600 text-sm mt-3"></div>
        </div>
      </section>

      <!-- Dashboard -->
      <section id="page-dashboard" class="page hidden">
        <div class="step-box max-w-4xl mx-auto">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold">Dashboard</h2>
            <div class="text-sm text-slate-500">Account overview</div>
          </div>

          <div id="dash-content" class="grid md:grid-cols-2 gap-6">
            <!-- left: overview -->
            <div class="bg-white p-4 rounded-xl border">
              <h3 class="font-semibold mb-2">Account Overview</h3>
              <div id="dash-overview" class="text-sm text-slate-700"></div>
            </div>

            <!-- right: verification images and devices -->
            <div class="bg-white p-4 rounded-xl border">
              <h3 class="font-semibold mb-2">Prank Document & Devices</h3>
              <div id="dash-docs" class="text-sm text-slate-700 mb-3"></div>
              <div id="dash-devices" class="text-sm text-slate-700"></div>
            </div>
          </div>

        </div>
      </section>
    </main>

    <footer class="text-center text-xs text-slate-500 mt-8">Enforcementmenu items
Show/hidePolicymenu items
Show/hideAdvice and Guidancemenu items
Show/hideNews and Eventsmenu items
Show/hideAbout the FTCmenu items
</footer>
  </div>

  <script>
    /* ============================
      
       ============================ */

    (function(){
      // Utilities
      const el = id => document.getElementById(id);
      const showPage = (pageId) => {
        document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
        el(pageId).classList.remove('hidden');
        // set nav highlight
        document.querySelectorAll('#nav-home, #nav-login, #nav-signup').forEach(btn => btn.classList.remove('ring','ring-indigo-300'));
      };

      // Basic city mapping
      const CITIES_BY_STATE = {
        "California": ["Los Angeles","San Diego","San Jose","San Francisco","Sacramento","Other"],
        "Texas": ["Houston","San Antonio","Dallas","Austin","Fort Worth","Other"],
        "Florida": ["Jacksonville","Miami","Tampa","Orlando","St. Petersburg","Other"],
        "New York": ["New York City","Buffalo","Rochester","Yonkers","Syracuse","Other"],
        "Illinois": ["Chicago","Aurora","Naperville","Joliet","Springfield","Other"],
        "Pennsylvania": ["Philadelphia","Pittsburgh","Allentown","Erie","Other"],
        "Ohio": ["Columbus","Cleveland","Cincinnati","Toledo","Other"],
        "Georgia": ["Atlanta","Augusta","Savannah","Columbus","Other"],
        "North Carolina": ["Charlotte","Raleigh","Greensboro","Durham","Other"],
        "Michigan": ["Detroit","Grand Rapids","Warren","Ann Arbor","Other"]
      };

      // Local storage helpers
      const STORAGE_KEY = 'ftc_demo_users';
      function loadUsers(){
        try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
        catch(e){ return []; }
      }
      function saveUsers(users){
        localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
      }

      // Current signup data (temporary)
      let signupData = {
        personal: {},
        contact: {},
        address: {},
        accountType: null,
        prankVerification: {},
        accountNumber: null,
        credentials: {},
        devices: {},
        security: {},
        createdAt: null
      };

      // Navigation bindings
      el('nav-home').addEventListener('click', ()=> showPage('page-home'));
      el('nav-login').addEventListener('click', ()=> showPage('page-login'));
      el('nav-signup').addEventListener('click', ()=> showPage('page-signup'));
      el('home-getstarted').addEventListener('click', ()=> showPage('page-signup'));
      el('home-login').addEventListener('click', ()=> showPage('page-login'));
      el('home-getstarted').addEventListener('click', ()=> startAtStep(1));
      el('nav-signup').addEventListener('click', ()=> startAtStep(1));
      el('home-login').addEventListener('click', ()=> showPage('page-login'));

      // Start signup at a step
      function startAtStep(n){
        showPage('page-signup');
        showStep(n);
      }

      // Show/hide step sections
      function showStep(n){
        document.querySelectorAll('.signup-step').forEach(s => s.classList.add('hidden'));
        const sEl = el('step-'+n);
        if(sEl) sEl.classList.remove('hidden');
      }

      // Step 1: personal
      el('step1-next').addEventListener('click', ()=>{
        signupData.personal.firstName = el('firstName').value.trim();
        signupData.personal.lastName = el('lastName').value.trim();
        signupData.personal.tsn = el('tsn').value.trim();
        // simple validation
        if(!signupData.personal.firstName || !signupData.personal.lastName){
          alert('Please provide first and last name.');
          return;
        }
        showStep(2);
      });
      el('step1-cancel').addEventListener('click', ()=> {
        // reset and go home
        signupData = {};
        showPage('page-home');
      });

      // Step 2: contact
      el('step2-back').addEventListener('click', ()=> showStep(1));
      el('step2-next').addEventListener('click', ()=>{
        signupData.contact.email = el('email').value.trim();
        signupData.contact.altEmail = el('altEmail').value.trim();
        signupData.contact.phone = el('phone').value.trim();
        signupData.contact.altPhone = el('altPhone').value.trim();
        if(!signupData.contact.email || !signupData.contact.phone){
          alert('Please provide primary email and phone.');
          return;
        }
        showStep(3);
      });

      // Step 3: address
      // populate cities when state changes
      el('state').addEventListener('change', (e)=>{
        const st = e.target.value;
        const citySel = el('city');
        citySel.innerHTML = '<option value="">Select city</option>';
        (CITIES_BY_STATE[st] || ['Other']).forEach(c => {
          const opt = document.createElement('option'); opt.value = c; opt.textContent = c; citySel.appendChild(opt);
        });
      });
      el('step3-back').addEventListener('click', ()=> showStep(2));
      el('step3-next').addEventListener('click', ()=>{
        signupData.address.state = el('state').value;
        signupData.address.city = el('city').value;
        signupData.address.zip = el('zip').value.trim();
        signupData.address.full = el('fullAddress').value.trim();
        if(!signupData.address.state || !signupData.address.city || !signupData.address.zip || !signupData.address.full){
          alert('Please complete the address fields.');
          return;
        }
        showStep(4);
      });

      // Step 4: account type
      el('step4-back').addEventListener('click', ()=> showStep(3));
      el('step4-next').addEventListener('click', ()=>{
        const r = document.querySelector('input[name="accountType"]:checked');
        if(!r){ alert('Please select an account type.'); return; }
        signupData.accountType = r.value;
        // attach interest rate for clarity
        signupData.accountTypeInterest = signupData.accountType === 'Victim' ? '11.5%' : signupData.accountType === 'Suspect' ? '3.5%' : '0%';
        showStep(5);
      });

      // Step 5: prank doc upload and 30s FTС connect
      function dataURLFromFile(file, cb){
        const reader = new FileReader();
        reader.onload = () => cb(reader.result);
        reader.readAsDataURL(file);
      }

      el('prankFront').addEventListener('change', (e)=>{
        const f = e.target.files[0];
        if(!f) return;
        dataURLFromFile(f, (durl) => {
          signupData.prankVerification.front = durl;
          el('previewFront').innerHTML = '<img class="img-preview" src="'+durl+'" alt="front"/>';
        });
      });
      el('prankBack').addEventListener('change', (e)=>{
        const f = e.target.files[0];
        if(!f) return;
        dataURLFromFile(f, (durl) => {
          signupData.prankVerification.back = durl;
          el('previewBack').innerHTML = '<img class="img-preview" src="'+durl+'" alt="back"/>';
        });
      });

      // FTC connection simulation (30s)
      let ftcTimer = null;
      el('start-ftc-conn').addEventListener('click', ()=>{
        // require both images uploaded
        if(!signupData.prankVerification.front || !signupData.prankVerification.back){
          if(!confirm('Front or back image missing. Continue connection simulation anyway?')) return;
        }
        el('ftc-status').textContent = "Status: connecting to the FTC network... (30s simulated)";
        el('start-ftc-conn').disabled = true;
        let left = 30;
        el('ftc-status').textContent = `Status: connecting to the FTC network... ${left}s`;
        ftcTimer = setInterval(()=>{
          left--;
          if(left <= 0){
            clearInterval(ftcTimer);
            el('ftc-status').textContent = 'Status: connected to the FTC network. You may proceed.';
            el('start-ftc-conn').disabled = false;
          } else {
            el('ftc-status').textContent = `Status: connecting to the FTC network... ${left}s`;
          }
        }, 1000);
      });

      el('step5-back').addEventListener('click', ()=> showStep(4));
      el('step5-next').addEventListener('click', ()=>{
        // require that the 30s connection completed at least once (ftc-status says connected) OR ask to confirm
        if(!el('ftc-status').textContent.includes('connected') && !confirm('The 30-second connection has not completed. Proceed anyway?')) return;
        signupData.prankVerification.type = el('prankDocType').value;
        showStep(6);
      });

      // Step 6: account numbers generation
      function generateAccountOptions(seq6){
        const seq = String(seq6).padStart(6,'0').slice(-6);
        const options = [];
        for(let i=0;i<6;i++){
          const prefix = Math.floor(Math.random()*999999).toString().padStart(6,'0');
          options.push(prefix + seq);
        }
        return options;
      }

      el('gen-acc-opts').addEventListener('click', ()=>{
        const s = el('seq6').value.trim();
        if(!/^\d{1,6}$/.test(s)){ alert('Enter a numeric sequence up to 6 digits.'); return; }
        const opts = generateAccountOptions(s);
        const container = el('acc-options');
        container.innerHTML = '';
        opts.forEach(opt => {
          const div = document.createElement('div');
          div.className = 'p-3 border rounded-lg flex justify-between items-center';
          div.innerHTML = `<div class="font-mono">${opt}</div><button class="px-3 py-1 rounded bg-indigo-600 text-white select-acc">Choose</button>`;
          div.querySelector('.select-acc').addEventListener('click', ()=>{
            // mark chosen
            document.querySelectorAll('#acc-options .selected').forEach(x=>x.classList.remove('selected'));
            div.classList.add('selected');
            signupData.accountNumber = opt;
            // visually indicate
            Array.from(container.children).forEach(ch => ch.classList.remove('bg-indigo-50','border-indigo-400'));
            div.classList.add('bg-indigo-50','border-indigo-400');
          });
          container.appendChild(div);
        });
      });

      el('step6-back').addEventListener('click', ()=> showStep(5));
      el('step6-next').addEventListener('click', ()=>{
        if(!signupData.accountNumber){ alert('Please choose a 12-digit account number from the options.'); return; }
        showStep(7);
      });

      // Step 7: credentials and Submit -> 2-minute scanning
      el('step7-back').addEventListener('click', ()=> showStep(6));
      el('step7-submit').addEventListener('click', ()=>{
        const u = el('username').value.trim();
        const p = el('password').value;
        const pc = el('passwordConfirm').value;
        if(!u || !p){ alert('Enter username and password.'); return; }
        if(p !== pc){ alert('Password confirmation does not match.'); return; }

        // Check duplicate username or email
        const users = loadUsers();
        if(users.some(us => us.credentials && us.credentials.username === u)){
          alert('Username already taken. Please choose another.');
          return;
        }
        if(users.some(us => us.contact && us.contact.email === signupData.contact.email)){
          alert('An account with that email already exists. Use login or another email.');
          return;
        }

        signupData.credentials.username = u;
        signupData.credentials.password = p; // demo only: stored in localStorage (plaintext) -> DO NOT DO THIS IN PRODUCTION
        signupData.createdAt = new Date().toISOString();

        // Simulate 2-minute scan
        showStep('scan-2min'); // show the 2-min scan step
        // visual countdown
        let left = 120; // seconds
        el('scan2-countdown').textContent = formatMMSS(left);
        const interval = setInterval(()=>{
          left--;
          el('scan2-countdown').textContent = formatMMSS(left);
          if(left<=0){
            clearInterval(interval);
            // proceed to device registration step (8)
            showStep(8);
          }
        }, 1000);
      });

      // Step 8: register devices
      el('step8-back').addEventListener('click', ()=> showStep(7));
      el('step8-next').addEventListener('click', ()=>{
        signupData.devices.count = el('deviceCount').value;
        // collect selected device types
        const sel = Array.from(el('deviceTypes').selectedOptions).map(o=>o.value);
        if(sel.length === 0){ if(!confirm('No device types selected. Continue?')) return; }
        signupData.devices.types = sel;
        showStep(9);
      });

      // Step 9: device IP
      el('step9-back').addEventListener('click', ()=> showStep(8));
      el('step9-next').addEventListener('click', ()=>{
        signupData.devices.ip = el('deviceIp').value.trim();
        if(!signupData.devices.ip){ if(!confirm('No IP entered. Continue?')) {} } // allow
        showStep(10);
      });

      // Step 10: security & token validation
      function setTokenResult(ok, message){
        const div = el('token-result');
        if(ok){
          div.className = 'mt-2 text-green-700 text-sm';
          div.textContent = message;
        } else {
          div.className = 'mt-2 text-rose-600 text-sm';
          div.textContent = message;
        }
      }

      el('validate-token').addEventListener('click', ()=>{
        const token = el('tokenId').value.trim();
        signupData.security.securityType = el('securityType').value;
        signupData.security.token = token;
        if(token === ''){
          setTokenResult(false,'No token entered.');
          return;
        }
        if(token === '3999041'){
          setTokenResult(true, 'Thanks for the confirmation — this case has been assigned to Officer Eric Charles Monti. Badge ID: EMCFTC1978');
        } else {
          setTokenResult(false, 'Invalid token.');
        }
      });

      el('step10-back').addEventListener('click', ()=> showStep(9));
      el('step10-next').addEventListener('click', ()=>{
        // require that token is valid OR ask for confirmation
        const token = el('tokenId').value.trim();
        if(token !== '3999041' && !confirm('Token is not validated as the special demo token. Proceed to final scan anyway?')) return;
        // Save security fields
        signupData.security.securityType = el('securityType').value;
        signupData.security.token = token;
        showStep('final-scan');
        // 3-minute countdown
        let left = 180;
        el('scan3-countdown').textContent = formatMMSS(left);
        const interval = setInterval(()=>{
          left--;
          el('scan3-countdown').textContent = formatMMSS(left);
          if(left<=0){
            clearInterval(interval);
            // Show final message and save user to localStorage
            // finalize user object and persist
            const userRecord = {
              personal: signupData.personal,
              contact: signupData.contact,
              address: signupData.address,
              accountType: signupData.accountType,
              accountTypeInterest: signupData.accountTypeInterest,
              prankVerification: signupData.prankVerification,
              accountNumber: signupData.accountNumber,
              credentials: signupData.credentials,
              devices: signupData.devices,
              security: signupData.security,
              createdAt: signupData.createdAt || new Date().toISOString()
            };
            const users = loadUsers();
            users.push(userRecord);
            saveUsers(users);
            // show final step
            showStep('complete');
            // start 60s redirect countdown
            let rleft = 60;
            el('redirect-countdown').textContent = rleft;
            const redInt = setInterval(()=>{
              rleft--;
              el('redirect-countdown').textContent = rleft;
              if(rleft<=0){
                clearInterval(redInt);
                // reset signupData and go to home
                signupData = {
                  personal: {},
                  contact: {},
                  address: {},
                  accountType: null,
                  prankVerification: {},
                  accountNumber: null,
                  credentials: {},
                  devices: {},
                  security: {},
                  createdAt: null
                };
                showPage('page-home');
              }
            }, 1000);
          }
        }, 1000);
      });

      // Login logic
      el('login-submit').addEventListener('click', ()=>{
        const id = el('loginId').value.trim();
        const pw = el('loginPassword').value;
        const users = loadUsers();
        const found = users.find(u => (u.contact && u.contact.email === id) || (u.credentials && u.credentials.username === id));
        if(!found){ el('login-error').textContent = 'No account found for that email/username.'; return; }
        if(!found.credentials || found.credentials.password !== pw){ el('login-error').textContent = 'Incorrect password.'; return; }
        // login success -> show dashboard and fill data
        populateDashboard(found);
        showPage('page-dashboard');
      });
      el('login-cancel').addEventListener('click', ()=> showPage('page-home'));

      // Dashboard population
      function populateDashboard(user){
        const ov = el('dash-overview');
        ov.innerHTML = `
          <div class="grid grid-cols-2 gap-2">
            <div class="text-slate-500">Name</div><div class="font-medium">${escapeHtml((user.personal.firstName||'') + ' ' + (user.personal.lastName||''))}</div>
            <div class="text-slate-500">TSN</div><div class="font-medium">${escapeHtml(user.personal.tsn||'')}</div>
            <div class="text-slate-500">Account Type</div><div class="font-medium">${escapeHtml(user.accountType)} (${escapeHtml(user.accountTypeInterest||'')})</div>
            <div class="text-slate-500">Email</div><div class="font-medium">${escapeHtml(user.contact.email||'')}</div>
            <div class="text-slate-500">Phone</div><div class="font-medium">${escapeHtml(user.contact.phone||'')}</div>
            <div class="text-slate-500">Account Number</div><div class="font-medium">${escapeHtml(user.accountNumber||'')}</div>
            <div class="text-slate-500">Username</div><div class="font-medium">${escapeHtml(user.credentials.username||'')}</div>
            <div class="text-slate-500">Registered devices</div><div class="font-medium">${(user.devices && user.devices.types) ? escapeHtml(user.devices.types.join(', ')) : 'None'}</div>
            <div class="text-slate-500">Registered IP</div><div class="font-medium">${escapeHtml((user.devices && user.devices.ip) || '')}</div>
            <div class="text-slate-500">Created</div><div class="font-medium">${new Date(user.createdAt).toLocaleString()}</div>
          </div>
        `;
        // docs
        const docs = el('dash-docs');
        docs.innerHTML = `<div class="text-sm"><strong>Prank Doc Type:</strong> ${escapeHtml(user.prankVerification.type||'')}</div>`;
        if(user.prankVerification.front){
          docs.innerHTML += `<div class="mt-2"><img class="img-preview" src="${user.prankVerification.front}" alt="front"/></div>`;
        }
        if(user.prankVerification.back){
          docs.innerHTML += `<div class="mt-2"><img class="img-preview" src="${user.prankVerification.back}" alt="back"/></div>`;
        }
        el('dash-devices').innerHTML = `<div><strong>Device Count:</strong> ${escapeHtml((user.devices && user.devices.count) || '')}</div>`;
      }

      // small helpers
      function formatMMSS(seconds){
        const mm = String(Math.floor(seconds/60)).padStart(2,'0');
        const ss = String(seconds % 60).padStart(2,'0');
        return mm + ':' + ss;
      }
      function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; }); }

      // show default home
      showPage('page-home');

      // ShowStep wrapper that accepts string ids used for scan display special cases
      function showStep(n){
        // if n is string like 'scan-2min', show the step with id 'step-scan-2min'
        if(typeof n === 'string'){
          // hide all steps
          document.querySelectorAll('.signup-step').forEach(s => s.classList.add('hidden'));
          const elId = n === 'scan-2min' ? 'step-scan-2min' : n === 'final-scan' ? 'step-final-scan' : n;
          if(el(elId)) el(elId).classList.remove('hidden');
        } else {
          document.querySelectorAll('.signup-step').forEach(s => s.classList.add('hidden'));
          const elId = 'step-' + n;
          if(el(elId)) el(elId).classList.remove('hidden');
        }
      }

      // expose global small utilities for debugging in console
      window.NovaWalletDemo = {
        loadUsers, saveUsers
      };

      // Ensure pages/steps hide/show at load
      document.querySelectorAll('.signup-step').forEach(s => s.classList.add('hidden'));
      showStep(1);

    })();
  </script>

</body>
</html>
